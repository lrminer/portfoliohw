YUI.add("fluid-magic-slideshow-view",function(i){i.namespace("Views")[this.name]=i.Base.create("fluid-magic-slideshow-view",i.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.modelParams=e.photoListConfig.modelParams,this.pageParams=e.pageParams,this.modelParams.fetchParams&&(this.pageParams=i.merge(this.modelParams.fetchParams,this.pageParams)),this.pageParams.viewPageSize?this.positionMultipler=this.pageParams.viewPageSize:this.positionMultipler=this.pageParams.perPage,this},loadState:function(){var i=this;return this.appContext.getModel(this.modelParams.registryName,this.modelParams.modelIdOrAttributes,this.modelParams.fetchParams).then(function(e){i.position=(i.pageParams.nominalPage-1)*i.positionMultipler||0,i.collection=e.getValue("photoPageList"),i.isEnabled=i.collection.totalItems>0}).catch(function(i){})},buildContainer:function(){return this.setContainerWithTemplate("fluid-magic-slideshow",{isEnabled:this.isEnabled}),this},toggleSlideshow:function(e){i.rapidTracker.beacon(this.name,"launchSlideshow"),e.halt(),new i.Views.Slideshow({appContext:this.appContext,collection:this.collection,pageParams:this.pageParams,position:this.position}).show()},activate:function(){return this.isEnabled&&this.registerEventHandler(this.get("container").one(".slideshow-toggle").on("click",this.toggleSlideshow.bind(this))),this}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-fluid-magic-slideshow","slideshow-view"],langBundles:["common"]});YUI.add("hermes-template-photostream-filter-tools",function(e,a){var l=e.Template.Handlebars.revive({1:function(e,a,l,r,n){var t;return'<div class="dropdown-link filter-view" aria-haspopup="true" aria-expanded="false" tabindex="0"><p>'+e.escapeExpression("function"==typeof(t=null!=(t=l.filterValue||(null!=a?a.filterValue:a))?t:l.helperMissing)?t.call(null!=a?a:{},{name:"filterValue",hash:{},data:n}):t)+"</p><span></span></div>\n"},compiler:[7,">= 4.0.0"],main:function(e,a,l,r,n){var t,s,i=null!=a?a:{};return'<div class="dropdown-link filter-sort" aria-haspopup="true" aria-expanded="false" tabindex="0"><p>'+e.escapeExpression("function"==typeof(s=null!=(s=l.sortValue||(null!=a?a.sortValue:a))?s:l.helperMissing)?s.call(i,{name:"sortValue",hash:{},data:n}):s)+"</p><span></span></div>\n"+(null!=(t=l.if.call(i,null!=a?a.viewingSelf:a,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?t:"")},useData:!0}),r={};e.Array.each([],function(a){var l=e.Template.get("hermes/"+a);l&&(r[a]=l)}),e.Template.register("hermes/photostream-filter-tools",function(a,n){return n=n||{},n.partials=n.partials?e.merge(r,n.partials):r,l(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photostream-filter-tools-view",function(e){var t={css:{filterView:".filter-view",filterSort:".filter-sort",help:".filter-helper .filter-helper-icon"}},r={me:"filter-bar.VIEW_ALL",fr:"filter-bar.FRIEND",fa:"filter-bar.FAMILY",ff:"filter-bar.FRIEND_AND_FAMILY",pu:"filter-bar.PUBLIC",dt:"cameraroll.DATE_TAKEN",dc:"cameraroll.DATE_UPLOADED"};e.namespace("Views")[this.name]=e.Base.create("photostream-filter-tools-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.set("viewingSelf",this.appContext.getViewer().nsid===this.nsid),this},loadState:function(){var t=this,r=[];return this.appContext.getViewer().signedIn&&r.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid).then(function(r){t.set("personPreferenceModel",r),t.set("filterValue",e.Models["person-preferences-models"].getReadablePrefName(r.getValue("photostreamViewAsPref"))),t.set("sortValue",e.Models["person-preferences-models"].getReadablePrefName(r.getValue("photostreamViewOrderPref")))})),e.Promise.all(r)},buildContainer:function(){var e=this.get("personPreferenceModel");return this.setContainerWithTemplate("photostream-filter-tools",{viewingSelf:this.get("viewingSelf"),sortValue:this.intlMessage({intlName:r[e.getValue("photostreamViewOrderPref")]}),filterValue:this.intlMessage({intlName:r[e.getValue("photostreamViewAsPref")]})}),this},activate:function(){return this.get("viewingSelf")&&(this.registerEventHandler(this.get("container").one(t.css.filterView).on("click",this.handleFilterView,this)),e.Accessibility.makeDroparoundAnchorAccessible({view:this,getDroparound:this.getDroparound.bind(this),anchor:this.get("container").one(".filter-view"),handler:this.handleFilterView.bind(this)})),this.registerEventHandler(this.get("container").one(t.css.filterSort).on("click",this.handleFilterSort,this)),e.Accessibility.makeDroparoundAnchorAccessible({view:this,getDroparound:this.getDroparound.bind(this),anchor:this.get("container").one(".filter-sort"),handler:this.handleFilterSort.bind(this)}),this},getDroparound:function(){return this.dropdown},handleFilterSort:function(t){t.halt();var r=this;this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one("span"),keyboardAnchorElement:t.target,minVerticalSpace:400,positionFixed:!0,preferLeft:!0,closeOnScroll:!0,anchorOffsetHorizontal:16,menuItems:[{text:this.intlMessage({intlName:"cameraroll.DATE_UPLOADED"}),data:"dateposted"},{text:this.intlMessage({intlName:"cameraroll.DATE_TAKEN"}),data:"datetaken"}]}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(e){e&&e.menuItem&&(r.get("container").one(".filter-sort p").set("text",e.menuItem.text),r.set("sortValue",e.menuItem.data),r.notifyPhotostreamToUpdate()),r.dropdown.close()}),this)},handleFilterView:function(t){t.halt();var r=this;this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one("span"),keyboardAnchorElement:t.target,minVerticalSpace:400,preferLeft:!0,closeOnScroll:!0,anchorOffsetHorizontal:16,positionFixed:!0,menuItems:[{text:this.intlMessage({intlName:"filter-bar.PUBLIC"}),data:"public"},{text:this.intlMessage({intlName:"filter-bar.FRIEND"}),data:"friend"},{text:this.intlMessage({intlName:"filter-bar.FAMILY"}),data:"family"},{text:this.intlMessage({intlName:"filter-bar.FRIEND_AND_FAMILY"}),data:"ff"},{text:this.intlMessage({intlName:"filter-bar.VIEW_ALL"}),data:"me"}]}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(e){e&&e.menuItem&&(r.get("container").one(".filter-view p").set("text",e.menuItem.text),r.set("filterValue",e.menuItem.data),r.notifyPhotostreamToUpdate()),r.dropdown.close()}),this)},notifyPhotostreamToUpdate:function(){var t=this;this.get("personPreferenceModel").setValues({photostreamViewAsPref:e.Models["person-preferences-models"].PHOTOSTREAM_VIEW_AS_TYPES[this.get("filterValue")],photostreamViewOrderPref:e.Models["person-preferences-models"].PHOTOSTREAM_VIEW_ORDER_TYPES[this.get("sortValue")]}),e.loaderBar.start(),this.get("personPreferenceModel").remoteUpdate().then(function(){t.fire("subviewViewEvent","photostream:filter",{filterValue:t.get("filterValue"),sortValue:t.get("sortValue")})})}},{ATTRS:{filterValue:{value:"me"},sortValue:{value:"dateposted"}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-photostream-filter-tools","loader-bar"],langBundles:["cameraroll","filter-bar"]});YUI.add("hermes-template-fluid-magic-tools",function(t,e){var a=t.Template.Handlebars.revive({1:function(t,e,a,l,n){return'\t\t<div class="share-link">\n\t\t\t'+t.escapeExpression((a.outlet||e&&e.outlet||a.helperMissing).call(null!=e?e:{},null!=e?e.shareView:e,{name:"outlet",hash:{},data:n}))+"\n\t\t</div>\n"},3:function(t,e,a,l,n){var i,s=null!=e?e:{},r=a.helperMissing,o=t.escapeExpression;return'\t\t\t<a class="edit-link" href="'+o("function"==typeof(i=null!=(i=a.editUrl||(null!=e?e.editUrl:e))?i:r)?i.call(s,{name:"editUrl",hash:{},data:n}):i)+'" title="'+o((a.intlMessage||e&&e.intlMessage||r).call(s,{name:"intlMessage",hash:{intlName:"photostream.EDIT_PHOTO_INFO"},data:n}))+'">\n\t\t\t\t<span class="fluid-edit-icon"></span>\n\t\t\t</a>\n'},compiler:[7,">= 4.0.0"],main:function(t,e,a,l,n){var i,s=null!=e?e:{},r=a.helperMissing,o=t.escapeExpression;return'<div class="fluid-centered fluid-magic-toolbar">\n\t<div class="primary-tools-container">\n\t\t'+o((a.outlet||e&&e.outlet||r).call(s,null!=e?e["photostream-filter-tools-view"]:e,{name:"outlet",hash:{},data:n}))+'\n\t</div>\n\n\t<div class="secondary-tools">\n'+(null!=(i=a.if.call(s,null!=e?e.shareView:e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n}))?i:"")+"\t\t"+o((a.outlet||e&&e.outlet||r).call(s,null!=e?e["fluid-magic-slideshow-view"]:e,{name:"outlet",hash:{},data:n}))+"\n\t\t"+o((a.outlet||e&&e.outlet||r).call(s,null!=e?e["fluid-magic-search-view"]:e,{name:"outlet",hash:{},data:n}))+"\n\n"+(null!=(i=a.if.call(s,null!=e?e.displayEditLink:e,{name:"if",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n}))?i:"")+"\t</div>\n</div>\n"},useData:!0}),l={};t.Array.each([],function(e){var a=t.Template.get("hermes/"+e);a&&(l[e]=a)}),t.Template.register("hermes/fluid-magic-tools",function(e,n){return n=n||{},n.partials=n.partials?t.merge(l,n.partials):l,a(e,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("fluid-magic-tools-view",function(e){e.namespace("Views")[this.name]=e.Base.create("fluid-magic-tools-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.set("selected",""),this.set("isEmptyPage",e.isEmptyPage),e.subnavConfig&&e.subnavConfig.selected&&this.set("selected",e.subnavConfig.selected),this.ownerNsid=e.nsid,this.page=e.pageParams&&e.pageParams.nominalPage,this},loadState:function(){var i=this;return e.Promise.resolve(this.appContext.getModel("person-models",this.ownerNsid)).then(function(e){i.set("personModel",e)})},subviewConfig:{"fluid-share-photostream-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,parentViewName:this.name,disabled:function(e){return"photostream"!==this.get("selected")||e.isMobile}},"fluid-share-favorites-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,parentViewName:this.name,disabled:function(e){return"favorites"!==this.get("selected")||e.isMobile}},"photostream-filter-tools-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return"photostream"!==this.get("selected")||!this.appContext.getViewer().signedIn},additionalViewClasses:["primary-tools"]},"fluid-magic-search-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!!this.get("isEmptyPage")},additionalViewClasses:["closed"]},"fluid-magic-slideshow-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!!this.get("isEmptyPage")}}},buildContainer:function(){var i,t=this.appContext.getViewer(),s=t.signedIn&&t.nsid===this.ownerNsid,r=e.URLHelper.generatePersonUrls(this.get("personModel"));return i={shareView:this.getShareViewContainer(),displayEditLink:"photostream"===this.get("selected")&&s&&!this.get("isEmptyPage")&&this.appContext.flipper.isFlipped("enable-photostream-edit")},null!==this.appContext.getLocation().href.match(/\/photos\/[^\/]+\/page/)?i.editUrl=r.photostreamEdit+"/page"+this.page:i.editUrl=r.photostreamEdit,this.setContainerWithTemplate("fluid-magic-tools",i),this},getShareViewContainer:function(){var e="";return this.subviews["fluid-share-"+this.get("selected")+"-view"]&&(e=this.subviews["fluid-share-"+this.get("selected")+"-view"].get("container")),e}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","fluid-share-photostream-view","fluid-share-favorites-view","fluid-magic-slideshow-view","photostream-filter-tools-view","hermes-template-fluid-magic-tools"],langBundles:["share-modal","common","photostream"]});YUI.add("hermes-lang-photostream",function(r,a){r.Intl.add("hermes/photostream","en-US",{EDIT_CAMERAROLL_ORGANIZR:["Edit in <a href='","${camerarollUrl}","'>Camera Roll</a> or <a href='","${organizrUrl}","'>Organizr</a>"],EDIT_PHOTO_INFO:["Edit photo info"]})},"@VERSION@",{requires:["intl"]});